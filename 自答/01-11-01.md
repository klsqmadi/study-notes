# 四次挥手
- 客户端向服务器发送一个Req，里面包含FIN标识位=1，CLient的seq序列号为N，表示当前client在当前连接的序列号，客户端处于FIN_WAIT1状态
- 服务器收到客户端发来的Req报文，会返回一个ACK响应报文，里面包含ACK标识位=1，同时seq为N+1，此时server同时会主动发送一个结束标识符给上层应用程序，应用程序可以决定是否立即结束，还是等到数据处理完之后再结束，此时服务器处于CLOSE_WAIT状态
- 客户端收到服务器ACK响应报文，会处于FIN_WAIT2状态
- 服务器的应用程序处理完数据之后会准备结束连接，会向客户端发送一个FIN报文，seq序列号为ISN，此时处于LAST_ACK状态
- 客户端收到服务器发来的FIN报文，也会回服务器一个ACK响应报文，里面包含ACK=1，seq值为ISN+1，此时处于TIME_WAIT状态
- 服务器收到ACK报文就会变为CLOSE状态
- 而客户端在等待2MSL，如果在2MSL之内没有收到服务器发来的ACK报文，才回进入CLOSE状态

# 为什么是2MSL
- 因为2MSL可以允许在第三四次挥手中最多丢失一次报文的机会，如果第四次挥手客户端发送的ACK响应报文在传输过程中丢失了，那么这段从发送到丢失的时间最多为MSL，服务器在发送FIN报文之后，会开启一个定时器，如果MSL内没有接收到客户端发送来的ACK响应报文，那么服务器就会重发FIN报文，如果在刚好发出FIN报文时，这时刚好第四次挥手客户端发送的ACK报文来到服务器，也没关系。所以2MSL允许丢失一次报文，那为什么不能丢失2次了，因为在丢包率1%的传输环境下，如果连续丢失2次，概率就是万分之一，解决这个问题的性价比不高

# tcp的特点
- 面向连接
- 可靠传输-检验和，超时重传，确认应答，连接管理，流量控制，拥塞控制
- 面向字节流传输，数据分片
- 端到端传输，单播传输
- 多路复用
- 全双工传输

# udp的特点
- 面向无连接
- 尽最大努力交付，不可靠
- 多播，广播，单播
- 面向报文
- 首部开销小

# tcp和udp的区别
- 就是特点区别