#### 浏览器构成

1. 用户界面 user interface
2. 浏览器引擎 brower engine：在UI界面和渲染引擎之间传递指令；同时操作数据存储
3. 渲染引擎 rendering engine：主要负责将请求的布局文件、样式文件进行解析渲染呈现出Web页面；
4. 网络 networking
5. js解释器 js interpreter
6. 用户界面后端 UI backend
7. 数据存储 data persistence

#### 渲染

- DOM tree -> Render Object -> Render Layer (处于相同坐标空间（z轴空间）的渲染对象，都将归并到同一个渲染层中)-> Graphics Layer

1. 解析HTML，(包含display：none的标签)生成DOM树，解析CSS,生成CSSOM树
2. 将DOM树和CSSOM树结合起来，生成渲染树，将dom树和对应的样式结合起来
3. 回流：根据生成的渲染树（不包含display：none标签），进行回流，计算它们在设备视口(viewport)内的确切位置和大小
4. 重绘：根据渲染树及回流的信息，得到节点的绝对像素，为每个节点分配坐标
5. display：将像素发给GPU，**为了提高页面呈现速度，渲染引擎采用的是渐进式渲染，也就是在边解析、边渲染的模式下进行工作的，它不必等着整个HTML解析完成再渲染。**

##### 重绘

当页面中元素样式的改变并**不影响它在文档流中的位置**时，浏览器只需要将新样式赋予给元素并重新绘制它，因此**性能损耗比较低**

##### 回流

当页面中部分或全部元素的尺寸、结构、或某些属性发生改变时，浏览器重新渲染部分或全部文档的过程（这一过程中浏览器需要重新的进行计算，计算后重新的对页面布局）称为**回流，又叫重排**（重排可以理解为对页面重新的进行了排版）因此是**较重的操作，性能损耗较高**

#### 何时发生回流

- 添加或删除可见dom元素
- 元素位置发生变化
- 元素尺寸发生变化
- 页面一开始渲染
- 浏览器页面尺寸发生变化,因为回流是根据视口的大小来计算元素的位置和大小的
- 通过innerHTML/innerText修改DOM节点上的字体信息
- 通过JS的dom中style属性来改变DOM节点的样式

#### 优化

1. 合并多次对DOM和样式的修改（大部分现代浏览器都对其做了优化，因此，只会触发一次重排。）
2. 脱离文档流
3. 创建文档碎片 createDoucumentFragment
4. 避免频繁读取offset，client
5. css3 transform opacity filters ，因为硬件加速  不会引起回流，如果使用left/top进行动画，会使animation节点和Document节点被放到同一个 图形层中进行渲染，不断执行重绘，因为使用css3 会使元素被提升为合成层,交由GPU进行渲染，不会影响其他层，动画会完全运行在 GPU 上，相比起 CPU 处理图层后再发送给显卡进行显示绘制来说，这样的动画往往更加流畅。
6. 减少隐式合成，浏览器为了保证正确的图层重叠顺序，会将合成元素之上的非合成元素提升为合成层，当这些不符合预期的合成层达到一定量级时，就会变成层爆炸。
7. 减少合成层的尺寸，减少内存消耗

