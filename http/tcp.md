## TCP/IP
### UDP
- udp全称用户数据包协议，它是一种无连接协议，是传输层协议
- udp不提供数据包分组，组装和不能对数据包进行排序的缺点，udp无法得知是否安全完整到达
#### 面向无连接
- udp不需要和tcp进行3次握手建立建立，只需要一次握手即可，发送过程中，不会对数据报进行任何拆分和拼接
- 在发送端，应用层将数据传输给传输层的udp协议，udp只会给数据包增加一个udp头标识，然后就传递给网络层，在接收端，udp只去除ip报文头就传递给应用层，不会进行拼接
#### 有单播，多播，广播
- udp支持一对一，一对多，多对多，多对一
#### udp面向报文
- 发送方的udp对应用程序交下来的报文，在添加首部后就向下交付，udp保留这些报文的边界，因此应用程序必须选择合适大小的报文
#### 不可靠性
1. 体现在无连接上
2. 不会对数据进行重传，不会关系是否正确接收到数据
3. 没有拥塞控制
#### 传输高效
- 头部开销小，不用维护连接状态，不用跟踪参数，不用建立连接
### TCP
- 特点
#### 三次握手四次挥手
#### 面向连接
#### 仅支持单播传输
#### 面向字节流
- tcp不像udp一样一个个报文独立地传输，而是在不保留报文边界的情况下以字节流方式进行传输
#### 可靠传输
#### 拥塞控制
#### tcp怎么保证可靠运输的
##### 检验和，用来检测数据是否有差错
##### 序列号/确认应答，没发送一个包就会回应一个包，如果没有收到回应确认包就会重发数据
##### 超时重传，在经过RTT之后，会认为丢包了，重新传输包，如果一个包经过多次重发也没有收到对方的确认包，就会关闭连接
##### 滑动窗口控制
- 滑动窗口通过在双方都建立一个缓冲区并维护，用来解决网络之间数据不可靠的问题，例如丢包，重复包，出错，乱序
- 双方通过商定 包如何重传的机制来解决不可靠的问题
###### 滑动窗口是如何保证次序的
- 通过确认应答的方式，发送方发送一个发送包，接收方就发送一个确认包回去，这样就可以解决丢包，出错，乱序问题，但是这样存在的问题就是吞吐量太小了，发送方发送完发送包，还需要等待确认包才能继续发送
###### 如何提高吞吐量
- 我们可以连着发送几个包等他一起确认吗？可以的，那一次性发送几个包最好呢
###### 如何实现最优解
- 我们能不能把第一个和第二个包发过去，收到第一个确认包就把第三个包发送过呢，而不是在等待第二个确认包之后才去发送第三个包
- 在丢包情况下，有可能是我们发过去的包丢了，有可能对方的ack丢了，如果在窗口内的第一个包还未ack，此时窗口是不会滑动的，而是会在超时过后选择超时重传，这个ack一定是会按顺序的
- 接收方的再返回ack的时候是可以告诉发送方他下一次想接收的包序号是多少，还会告诉发送方此时接收方的窗口大小为多少
###### 重传机制
- 超时重传，RTO应该略大于RTT，但RTT的值经常变化，所以RTO也是一个动态文化的值，linux通过采样RTT的时间，然后进行加权平均，算出一个平滑的RTT值，还要采样RTT波动范围
- 快速重传，三次同样的ACK就会触发重传机制，那么时重传之前的一个还是重传所有
- SACK，选择性确认，在tcp头部加一个SACK的字段，可以将缓存的数据发送给发送方，发送方就知道哪些数据收到了，就可以只重传丢失的数据
###### 持续计数器
- 如果B向A发送一个0窗口值，然后B又有了接收空间，就想向A发送一个400窗口值，但此时报文丢失了，
- 发送方收到一个0窗口计数器时，会启动tcp持续计数器，若持续计数器超时，发送方就会给接收方发送一个0窗口探测报文
##### 流量控制
- tcp提供一种可以让发送方根据接收方的实际接收能力控制发送的数据量，这就是流量控制
##### 拥塞控制
- 什么是拥塞控制：是一种用来调整tcp连续单次发送数据包的分组数量的算法，使其发送速率匹配当前的网络速率
- 通过控制滑动窗口的大小，来进行拥塞控制
- 慢启动
- 发送数量从1开始，指数型增加，直到到达阈值，然后进行拥塞避免
- 拥塞避免，每收到一个ACK，滑动窗口大小增加1 / cwnd
- 1. 发送超时重传，说明数据包阻塞，会将阈值变为cwnd / 2，cwnd置为1  
- 2. 连续收到3个同样的ACK，肯定不是阻塞，触发快速重传机制，cwnd = cwnd / 2，阈值变为cwnd，然后进入快速恢复算法，
- 3. cwnd = 阈值+3，重传丢失的数据包，如果再收到重复的ACK，cwnd+1，如果收到新的ACK,设置cwnd为阈值，进入拥塞避免算法
##### 停止等待协议
## tcp/ip模型
- tcp/ip模型是多种协议族的总称，tcp，udp，ip，ftp，http，icmp，smtp，dns等都属于tcp/ip协议族
- 这些协议分布在链路层，网络层，传输层，应用层
- 链路层：负责封装和解封ip报文，发送和接收ARP报文
- 网络层：负责路由以及把分组报文发送给目标网络和主机
- 传输层：负责对报文进行分组和重组，并以TCP或UDP协议格式封装报文
- 应用层：负责向用户提供应用